// SVG
var englishIcon = '<svg class="w-12 h-12" enable-background="new 0 0 512 512" viewBox="0 0 512 512" xmlns="www.w3.org/2000/svg"><circle cx="256" cy="256" fill="#f0f0f0" r="256"/><g fill="#0052b4"><path d="m52.92 100.142c-20.109 26.163-35.272 56.318-44.101 89.077h133.178z"/><path d="m503.181 189.219c-8.829-32.758-23.993-62.913-44.101-89.076l-89.075 89.076z"/><path d="m8.819 322.784c8.83 32.758 23.993 62.913 44.101 89.075l89.074-89.075z"/><path d="m411.858 52.921c-26.163-20.109-56.317-35.272-89.076-44.102v133.177z"/><path d="m100.142 459.079c26.163 20.109 56.318 35.272 89.076 44.102v-133.176z"/><path d="m189.217 8.819c-32.758 8.83-62.913 23.993-89.075 44.101l89.075 89.075z"/><path d="m322.783 503.181c32.758-8.83 62.913-23.993 89.075-44.101l-89.075-89.075z"/><path d="m370.005 322.784 89.075 89.076c20.108-26.162 35.272-56.318 44.101-89.076z"/></g><g fill="#d80027"><path d="m509.833 222.609h-220.44-.001v-220.442c-10.931-1.423-22.075-2.167-33.392-2.167-11.319 0-22.461.744-33.391 2.167v220.44.001h-220.442c-1.423 10.931-2.167 22.075-2.167 33.392 0 11.319.744 22.461 2.167 33.391h220.44.001v220.442c10.931 1.423 22.073 2.167 33.392 2.167 11.317 0 22.461-.743 33.391-2.167v-220.44-.001h220.442c1.423-10.931 2.167-22.073 2.167-33.392 0-11.317-.744-22.461-2.167-33.391z"/><path d="m322.783 322.784 114.236 114.236c5.254-5.252 10.266-10.743 15.048-16.435l-97.802-97.802h-31.482z"/><path d="m189.217 322.784h-.002l-114.235 114.235c5.252 5.254 10.743 10.266 16.435 15.048l97.802-97.804z"/><path d="m189.217 189.219v-.002l-114.236-114.237c-5.254 5.252-10.266 10.743-15.048 16.435l97.803 97.803h31.481z"/><path d="m322.783 189.219 114.237-114.238c-5.252-5.254-10.743-10.266-16.435-15.047l-97.802 97.803z"/></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg>'
var icelandicIcon = '<svg class="w-12 h-12" enable-background="new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><circle cx="256" cy="256" fill="#f0f0f0" r="256"/><g fill="#0052b4"><path d="m8.819 322.783c14.812 54.959 47.457 102.593 91.355 136.322v-136.322z"/><path d="m233.739 511.026c7.338.632 14.759.974 22.261.974 118.279 0 217.805-80.221 247.181-189.217h-269.442z"/><path d="m503.181 189.217c-29.376-108.996-128.902-189.217-247.181-189.217-7.502 0-14.923.342-22.261.974v188.243z"/><path d="m100.174 52.895c-43.898 33.73-76.543 81.363-91.355 136.322h91.355z"/></g><path d="m509.833 222.609h-309.484-.001v-216.524c-23.658 5.246-46.087 13.749-66.783 25.042v191.481h-131.398c-1.425 10.931-2.167 22.075-2.167 33.392s.742 22.461 2.167 33.391h131.397.001v191.481c20.696 11.292 43.125 19.797 66.783 25.042v-216.52-.002h309.485c1.423-10.931 2.167-22.075 2.167-33.392s-.744-22.461-2.167-33.391z" fill="#d80027"/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg>'
var editIcon = '<svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 10L14 6M18 10L21 7L17 3L14 6M18 10L17 11M14 6L8 12V16H12L14.5 13.5M20 14V20H12M10 4L4 4L4 20H7" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'
var resetIcon = '<svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 14C7.50963 15.0039 8.37532 15.8345 9.46665 16.3667C10.558 16.8989 11.8158 17.1038 13.0506 16.9505C15.0687 16.7 16.4753 15.3884 18 14.1814M18 17V14H15M17 10C16.4904 8.99609 15.6247 8.16548 14.5334 7.63331C13.442 7.10113 12.1842 6.89624 10.9494 7.04949C8.93127 7.29995 7.52468 8.61162 6 9.81861M6 7V10H9" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'
var gitIcon = '<svg width="98" height="96" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="#24292f"/></svg>'
var gitWhiteIcon = '<svg width="98" height="96" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="#fff"/></svg>'

// init
var jobs = document.getElementsByClassName("job")

document.getElementById("menuLanguage").addEventListener("click",toggleLanguage)
document.getElementById("menuEdit").addEventListener("click",toggleEdit)
document.getElementById("menuReset").addEventListener("click",()=>{resetStorage(false)})
Array.from(jobs).forEach((job) => {
    if(job.id != ""){
        job.addEventListener("click", jobClick)
    }
})

resetStorage(true)

// lib

function jobClick(e){
    if(localStorage.getItem("editMode")=="true"){
        let job = findParentByType(e,"job")
        if(findParentByType(e,"details")){
            toggleDetails(job)
        } else {
            if (isHidden(job)){
                enableJob(job)
            } else {
                disableJob(job)
            }
        }
        updateDOM()
        console.log(job)
    }
};

function isHidden(e){
    let vis = sessionStorage.getItem(e.id)
    if(vis == "true"){ // JS returns bool from storage as string
        return false
    } else
    {
        return true
    }
};

function resetStorage(init = false){
    if(init){ 
        document.getElementById("menuLanguage").innerHTML=englishIcon
        document.getElementById("menuEdit").innerHTML=editIcon
        document.getElementById("menuReset").innerHTML=resetIcon
        document.getElementById("menuGit").innerHTML=gitIcon
    } else {
        console.log("reset")
        localStorage.clear();
        sessionStorage.clear();
    }
    localStorage.setItem("editMode",false)
    if (localStorage.getItem("language") != "icelandic" && localStorage.getItem("language") != "english"){
        localStorage.setItem("language", "english")
    }

    Array.from(jobs).forEach((job) => {
        if(job.id != ""){
            enableJob(job)
        }
    })
    updateDOM()
}

function findParentByType(e,type){
    var isType = false
    var eParent = e.srcElement.parentNode
    var i = 0 // loop failsafe

    while(isType == false && i < 5){
        console.log(eParent.className)
        if (eParent.className.includes(type)){
            isType = true;
            return eParent
        }
        else {
            eParent = eParent.parentNode
        }
        i++
    }
    return false
}

function enableJob(job){
    sessionStorage.setItem(job.id, true)
    enableDetails(job)
}

function disableJob(job){
    sessionStorage.setItem(job.id, false)
}

function toggleDetails(job){
    if(sessionStorage.getItem(job.id+"-details")=="true"){
        disableDetails(job)
    } else {
        enableDetails(job)
    }
}

function enableDetails(job){
    sessionStorage.setItem(job.id+"-details", true)
}

function disableDetails(job){
    sessionStorage.setItem(job.id+"-details", false)
}

function toggleLanguage(){
    if(localStorage.getItem("language") == "english"){
        localStorage.setItem("language", "icelandic")
        document.getElementById("menuLanguage").innerHTML=englishIcon
    } else {
        localStorage.setItem("language", "english")
        document.getElementById("menuLanguage").innerHTML=icelandicIcon
    }
    updateDOM()
}

function updateDOM(){
    // Language toggle
    if(localStorage.getItem("language") == "icelandic"){
        Array.from(document.getElementsByClassName("english")).forEach((e) => {
            console.log(e)
            e.style.display="none"
        })
        Array.from(document.getElementsByClassName("icelandic")).forEach((e) => {
            e.style.display=""
        })
    } else {
        Array.from(document.getElementsByClassName("icelandic")).forEach((e) => {
            e.style.display="none"
        })
        Array.from(document.getElementsByClassName("english")).forEach((e) => {
            e.style.display=""
        })
    }
    for (const [key, value] of Object.entries(sessionStorage)) {
        // Detail toggle
        if(key.includes("-details")){
            let job = document.getElementById(key.split("-details")[0])
            Array.from(job.children).forEach((child) => {
                    if(child.className.includes("details")){
                        if(
                            value == "true" && (
                                (localStorage.getItem("language") == "icelandic") && child.className.includes("icelandic") ||
                                (localStorage.getItem("language") == "english") && child.className.includes("english")
                                )
                            ){
                            console.log(child)
                            child.style.display=""
                            child.style.opacity="1"
                        } else {
                            console.log(child)
                            if(
                                localStorage.getItem("editMode")=="true" && (
                                    (localStorage.getItem("language") == "icelandic") && child.className.includes("icelandic") ||
                                    (localStorage.getItem("language") == "english") && child.className.includes("english")
                                )
                            ){
                                child.style.display=""
                                child.style.opacity="0.5"
                            } else {
                                child.style.display="none"
                            }
                        }
                    }
            })
        // Job toggle
        } else if(key.includes("job-")){
            let job = document.getElementById(key)
            if(localStorage.getItem("editMode")=="true"){
                Array.from(job.children).forEach(() => {
                    job.style.display = ""
                    if(value == "false"){
                        job.style.opacity = "0.5"
                    } else {
                        job.style.opacity = "1"
                    }
                })
            } else {
                Array.from(job.children).forEach(() => {
                    if(value == "false"){
                        job.style.display = "none"
                    } else {
                        job.style.display = ""
                        job.style.opacity = "1"
                    }
                })
            }
        }
    }
    
}

function toggleEdit(){
    if (localStorage.getItem("editMode")=="true"){
        localStorage.setItem("editMode",false)
        document.getElementById("menuEdit").innerHTML=editIcon
    } else {
        localStorage.setItem("editMode",true)
        document.getElementById("menuEdit").innerHTML="Edit Off"
    }
    updateDOM()
}

console.log(jobs)
console.log(sessionStorage)